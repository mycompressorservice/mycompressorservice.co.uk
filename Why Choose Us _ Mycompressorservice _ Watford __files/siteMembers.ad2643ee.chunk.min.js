(self.webpackJsonp__wix_thunderbolt_app=self.webpackJsonp__wix_thunderbolt_app||[]).push([[4522],{31857:function(e,t,n){"use strict";n.r(t),n.d(t,{AUTH_RESULT_REASON:function(){return C.$9},BIEvents:function(){return y},INTERACTIONS:function(){return C.SE},PrivacyStatus:function(){return C.iY},SiteMembersApiSymbol:function(){return D.n9},isLoginAcceptableError:function(){return E.Y2},isSignupAcceptableError:function(){return E.fJ},memberDetailsFromDTO:function(){return E.Ky},page:function(){return J},site:function(){return N}});var o=n(43757),i=n(31191),r=n(61049),s=n(49574),a=n(5096),u=n(55048),c=n(98333),l=n(10666),d=n(58629),m=n(26513),h=n(82627),g=n(8562),p=n(56405),f=n(19238),v=n(87821),b=n(23228),S=n(99552),w=n(16684),C=n(95848),P=n(51831),D=n(2811),k=function(){function e(e,t,n){this.propsStore=e,this.structureApi=t,this.siteScrollBlocker=n}return e.prototype.displayDialog=function(e,t,n,o){return void 0===o&&(o={}),(0,i.mG)(this,void 0,Promise,(function(){var r,s,a,u=this;return(0,i.Jh)(this,(function(c){switch(c.label){case 0:return r=function(){return(0,i.mG)(u,void 0,void 0,(function(){var o,r;return(0,i.Jh)(this,(function(s){switch(s.label){case 0:return o=(0,w.uniqueId)(D.rj),this.propsStore.update(((r={})[o]=(0,i.pi)((0,i.pi)({},t),n),r)),(0,P.U)(),[4,this.structureApi.addComponentToDynamicStructure(o,{componentType:e,components:[]})];case 1:return s.sent(),this.currentCompId&&(this.structureApi.removeComponentFromDynamicStructure(this.currentCompId),this.siteScrollBlocker.setSiteScrollingBlocked(!1,this.currentCompId)),this.siteScrollBlocker.setSiteScrollingBlocked(!0,o),this.currentCompId=o,[2]}}))}))},s=o.shouldWaitForAppDidMount,a=o.registerToAppDidMount,s&&a?(a(r),[3,3]):[3,1];case 1:return[4,r()];case 2:c.sent(),c.label=3;case 3:return[2]}}))}))},e.prototype.hideDialog=function(){this.currentCompId&&(this.structureApi.removeComponentFromDynamicStructure(this.currentCompId),this.siteScrollBlocker.setSiteScrollingBlocked(!1,this.currentCompId),(0,P.i)()),this.currentCompId=void 0},e}(),E=n(43096),y=function(e){var t=e.sessionManager,n=e.businessLogger,o=e.wixBiSession,r=e.viewMode,s=e.language,a=function(e,n){return{biToken:o.msId,context:e,ts:T(o),viewmode:r,visitor_id:t.getVisitorId(),site_member_id:t.getSiteMemberId(),vsi:o.viewerSessionId,site_settings_lng:s.siteLanguage,browser_lng:s.userLanguage,lng_mismatch:s.siteLanguage!==s.userLanguage,layout:n}};return{loginOrSignUpDialogLoaded:function(e,t){void 0===t&&(t="fullscreen"),n.logger.log((0,i.pi)({src:5,evid:658},a(e,t)),{endpoint:"site-members"})},closingDialog:function(e,t){void 0===t&&(t="fullscreen"),n.logger.log((0,i.pi)({src:5,evid:602,form_type:"default"},a(e,t)),{endpoint:"site-members"})},emailAuthSubmitClicked:function(e,t){n.logger.log((0,i.pi)({src:5,evid:603,form_type:"default"},a(e,t)),{endpoint:"site-members"})},siteMembersFeatureLoaded:function(){n.logger.log((0,i.pi)({src:5,evid:698},a()),{endpoint:"site-members"})},siteMembersSdkFeatureLoaded:function(){n.logger.log((0,i.pi)({src:5,evid:699},a()),{endpoint:"site-members"})}}},T=function(e){var t=e.initialTimestamp||0;return Date.now()-t},L=function(){function e(e){this.shouldRunCustomPopupCloseCallback=!0,this.popups=e}return e.prototype.openPopupPage=function(e,t,n){var o;return(0,i.mG)(this,void 0,void 0,(function(){var r,s=this;return(0,i.Jh)(this,(function(i){switch(i.label){case 0:return r=this.shouldRunCustomPopupCloseCallback,this.shouldRunCustomPopupCloseCallback=!1,this.assignRequestAuthenticationRejection(t),[4,null===(o=this.popups)||void 0===o?void 0:o.openPopupPage(e,(function(){s.shouldRunCustomPopupCloseCallback&&(s.rejectAuthenticationRequest(),n&&n())}))];case 1:return i.sent(),this.shouldRunCustomPopupCloseCallback=r,[2]}}))}))},e.prototype.preventCustomPopupCloseCallback=function(){this.shouldRunCustomPopupCloseCallback=!1},e.prototype.allowCustomPopupCloseCallback=function(){this.shouldRunCustomPopupCloseCallback=!0},e.prototype.assignRequestAuthenticationRejection=function(e){this.requestAuthenticationRejection=this.requestAuthenticationRejection||e},e.prototype.rejectAuthenticationRequest=function(){this.requestAuthenticationRejection&&(this.requestAuthenticationRejection(C.$9.CANCELED),this.requestAuthenticationRejection=void 0)},e}(),I=function(e,t,n){document.cookie=e+"=;max-age=0",document.cookie=e+"=;max-age=0;path="+t,document.cookie=e+"=;domain="+n+";max-age=0",document.cookie=e+"=;domain="+n+";max-age=0;path="+t},A=(0,o.ff)([(0,o.t6)(r.R9,D.u2),(0,o.t6)(r.jC,D.u2),(0,o.t6)(r.Wf,D.u2),s.U,a.EE,a.Zr,p.X,u.xP,u.QZ,a.bk,a.ZQ,f.F0,v.x,c.v,f.Iz,l.$,d.s,(0,o.jt)(b.r_),(0,o.jt)(S.I),m.jj,h.O],(function(e,t,n,o,r,s,a,u,c,l,d,m,h,p,f,v,b,S,P,D,T){var A,R;void 0===P&&(P={trackEvent:function(){return 0}});var _=e.collectionExposure,M=e.smcollectionId,O=e.svSession,U=e.smSessionCookie,G=e.protectedHomepage,N=e.isCommunityInstalled,J=e.memberInfoAppId,x=e.sm_efCookie,F="WixInternal"===_,j=a.getAppInstanceByAppDefId("22bef345-3c5b-4c18-b782-74d4085112ff"),q=null!==(A=a.getVisitorId())&&void 0!==A?A:"00000000-0000-0000-0000-000000000000",W=t.smSettings,B=t.tpaApplicationIds,V=t.policyLinks,K=J&&B[J],z=s.site,Y=z.siteRevision,H=z.metaSiteId,$=z.siteId,X=z.externalBaseUrl,Q=s.requestUrl,Z=s.viewMode,ee=-1!==C.F0.findIndex((function(e){var t,n;return null===(n=null===(t=null==d?void 0:d.navigator)||void 0===t?void 0:t.userAgent)||void 0===n?void 0:n.includes(e)})),te=!(T["specs.thunderbolt.sm_socialAuthMessageInInAppBrowser"]&&ee),ne=!(T["specs.thunderbolt.sm_customLoginSocialAuthMessageInInAppBrowser"]&&ee),oe="/_api/wix-sm-webapp/tokens/verify/"+H+"/"+$,ie=X.replace(/\/$/,"")+"/api/wix-sm/v1/authorize/"+$+"/pages",re="/_api/wix-sm-webapp/tokens/logout/"+H,se="/_api/wix-sm-webapp/member/changePasswordWithMailToken?metaSiteId="+H+"&collectionId="+M,ae="/_api/wix-sm-webapp/social/token/handle?metaSiteId="+H+"&collectionId="+M,ue=X.replace(/\/$/,"")+"/_api/dynamicmodel",ce=W.smFirstDialogLogin?"login":"signup",le=W.socialLoginFacebookEnabled,de=W.socialLoginGoogleEnabled,me=W.termsOfUse,he=W.privacyPolicy,ge=W.codeOfConduct,pe=W.customSignUpPageId,fe=W.customSignInPageId,ve=null===(R=W.joinCommunityCheckedByDefault)||void 0===R||R,be=e.smToken,Se={},we=U,Ce=null,Pe=!1,De=function(e){Ce=e},ke=function(){var e=!D.getCurrentRouteInfo();return{registerToAppDidMount:De,shouldWaitForAppDidMount:!Pe&&e}},Ee={},ye={},Te=y({sessionManager:a,businessLogger:v,wixBiSession:b,viewMode:null==Z?void 0:Z.toUpperCase(),language:l});Te.siteMembersFeatureLoaded();var Le={},Ie=(0,E.Qn)(o,{credentials:"same-origin",headers:{accept:"application/json","x-wix-site-revision":""+Y,"x-wix-client-artifact-id":"thunderbolt"}},s.requestUrl),Ae=function(e,t,n){return new k(e,t,n)}(u,c,h),Re=T["specs.thunderbolt.sm_googleAuthViaSDK"],_e=new L(S),Me={appDidMount:function(){Ce&&Ce(),Pe=!0},login:function(e,t,n,o){return void 0===o&&(o=!1),(0,i.mG)(this,void 0,Promise,(function(){var r,s,a;return(0,i.Jh)(this,(function(i){switch(i.label){case 0:P.trackEvent({eventName:"CustomEvent",params:{eventCategory:"Site members",eventAction:"Log in Submit",eventLabel:"Wix"}}),i.label=1;case 1:return i.trys.push([1,4,,5]),[4,Me.performLogin(e,t,n)];case 2:return r=i.sent(),[4,Me.handleLoginResponse(r,o)];case 3:return s=i.sent(),P.trackEvent({eventName:"CustomEvent",params:{eventCategory:"Site members",eventAction:"Log in Success",eventLabel:"Wix"}}),[2,s];case 4:throw a=i.sent(),P.trackEvent({eventName:"CustomEvent",params:{eventCategory:"Site members",eventAction:"Log in Failure",eventLabel:"Wix"}}),a;case 5:return[2]}}))}))},performLogin:function(e,t,n){var o;return(0,i.mG)(this,void 0,Promise,(function(){var r,s,a,u,c,l,d,m,h;return(0,i.Jh)(this,(function(i){switch(i.label){case 0:return T["specs.thunderbolt.sm_platformizedLogin"]?[4,Ie("/_api/wix-sm-webapp/v1/auth/login",{method:"POST",headers:{"Content-Type":"application/json",authorization:j||""},body:JSON.stringify({email:e,password:t,recaptchaToken:null==n?void 0:n.recaptchaToken})})]:[3,2];case 1:return[2,{member:(r=i.sent()).member,token:null===(o=null==r?void 0:r.session)||void 0===o?void 0:o.token}];case 2:return s=encodeURIComponent(e),a=encodeURIComponent(t),u="email="+s+"&password="+a+"&collectionId="+M+"&metaSiteId="+H+"&appUrl="+Q+"&svSession="+O,(null==n?void 0:n.recaptchaToken)&&(u=u+"&recaptchaToken="+n.recaptchaToken),[4,Ie("/_api/wix-sm-webapp/member/login",{method:"POST",body:u})];case 3:if(c=i.sent(),l=c.errorCode,d=c.payload,l)throw l;return m=d.sessionToken,h=d.siteMemberDto,[2,{member:(0,E.Ky)(h),token:m}]}}))}))},handleOauthToken:function(e,t,n,o,s){return void 0===s&&(s=!1),(0,i.mG)(this,void 0,Promise,(function(){var u,c,d,m,h,g,p,f;return(0,i.Jh)(this,(function(i){switch(i.label){case 0:return u=a.getVisitorId(),r.interactionStarted(C.SE.SOCIAL_APP_LOGIN),P.trackEvent({eventName:"CustomEvent",params:{eventCategory:"Site members",eventAction:"Log in Submit",eventLabel:t}}),[4,Ie(ae,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({svSession:O,visitorId:u,token:e,provider:t,mode:n,lang:l.userLanguage,privacyStatus:o})})];case 1:if(c=i.sent(),d=c.errorCode,m=c.payload,d)throw P.trackEvent({eventName:"CustomEvent",params:{eventCategory:"Site members",eventAction:"Log in Failure",eventLabel:t}}),d;return r.interactionEnded(C.SE.SOCIAL_APP_LOGIN),m.smSession&&(g=m.smSession.siteMemberDto,h=m.smSession.sessionToken),g=m.siteMemberDto,p=(0,E.Ky)(g),[4,Me.handleLoginResponse({member:p,token:h},s)];case 2:return f=i.sent(),P.trackEvent({eventName:"CustomEvent",params:{eventCategory:"Site members",eventAction:"Log in Success",eventLabel:t}}),[2,f]}}))}))},handleSocialLoginResponse:function(e,t,n){return void 0===n&&(n=!1),(0,i.mG)(this,void 0,Promise,(function(){var o,s,a,u;return(0,i.Jh)(this,(function(i){switch(i.label){case 0:return r.interactionStarted(C.SE.SOCIAL_APP_LOGIN),r.interactionEnded(C.SE.SOCIAL_APP_LOGIN),P.trackEvent({eventName:"CustomEvent",params:{eventCategory:"Site members",eventAction:"Log in Submit",eventLabel:t}}),e.smSession&&(s=e.smSession.siteMemberDto,o=e.smSession.sessionToken),s=e.siteMemberDto,a=(0,E.Ky)(s),[4,Me.handleLoginResponse({member:a,token:o},n)];case 1:return u=i.sent(),P.trackEvent({eventName:"CustomEvent",params:{eventCategory:"Site members",eventAction:"Log in Success",eventLabel:t}}),[2,u]}}))}))},handleLoginResponse:function(e,t){var n=e.token,o=e.member;return void 0===t&&(t=!1),(0,i.mG)(this,void 0,Promise,(function(){var e,r,s;return(0,i.Jh)(this,(function(a){switch(a.label){case 0:return e=o.emailVerified,n||e||"ACTIVE"!==o.status?[3,2]:[4,Me.showConfirmationEmailDialog(o.id)];case 1:return a.sent(),[2,(0,E.Y_)()];case 2:return n?[3,5]:[4,p()];case 3:return r=a.sent(),[4,Me.showNotificationDialog("",(r("siteMembersTranslations","SMApply_Success1","Success! Your member signup request has been sent and is awaiting approval.")+" "+r("siteMembersTranslations","SMApply_Success2","The site administrator will notify you via email ({0}) once your request has been approved.")).replace("{0}",o.loginEmail),r("siteMembersTranslations","SMContainer_OK","OK"))];case 4:return a.sent(),[2,(0,E.Y_)()];case 5:return[4,Me.applySessionToken(n,o,t)];case 6:return s=a.sent(),[2,(0,i.pi)({sessionToken:n,member:o},t?{pages:s}:{})]}}))}))},promptLogin:function(e,t,n){void 0===e&&(e={}),void 0===t&&(t=!0),void 0===n&&(n=!1);var o=e.mode,i=e.modal?"popup":"fullscreen";return"login"===(null!=o?o:ce)?Me.showLoginDialog(t,i,n):Me.showSignUpDialog(t,i,n)},promptForgotPassword:function(e){return void 0===e&&(e=!0),new Promise((function(t,n){_e.assignRequestAuthenticationRejection(n);var o={isCloseable:e},r={onCloseDialogCallback:function(){Te.closingDialog("RequestResetPassword"),Ae.hideDialog(),_e.rejectAuthenticationRequest()},onSubmitCallback:function(e){var n=this;return Me.sendForgotPasswordMail(e).then((function(){return(0,i.mG)(n,void 0,void 0,(function(){var e;return(0,i.Jh)(this,(function(n){switch(n.label){case 0:return[4,p()];case 1:return e=n.sent(),Me.showNotificationDialog(e("siteMembersTranslations","siteMembersTranslations_RESET_PASSWORD_CHECKEMAIL_TITLE","Please Check Your Email"),e("siteMembersTranslations","siteMembersTranslations_RESET_PASSWORD_CHECKEMAIL_TEXT","We\u2019ve emailed you a link to reset your password."),e("siteMembersTranslations","siteMembersTranslations_Reset_Password_OK","Got It")),t(),[2]}}))}))}))}};Ae.displayDialog("RequestPasswordResetDialog",o,r)}))},requestAuthentication:function(e){return void 0===e&&(e={}),(0,i.mG)(this,void 0,Promise,(function(){var t;return(0,i.Jh)(this,(function(n){switch(n.label){case 0:if(we)return[2,{success:!0,token:we,reason:C.$9.ALREADY_LOGGED_IN}];n.label=1;case 1:return n.trys.push([1,3,,4]),t=!G,[4,Me.promptLogin(e,t)];case 2:return[2,{success:!0,token:n.sent().sessionToken,reason:C.$9.SUCCESS}];case 3:return[2,{success:!1,reason:n.sent()}];case 4:return[2]}}))}))},requestAuthorizedPages:function(e){return void 0===e&&(e={}),(0,i.mG)(this,void 0,Promise,(function(){var t,n;return(0,i.Jh)(this,(function(o){switch(o.label){case 0:return be?(n={success:!0},[4,Me.authorizeMemberPagesBySignedInstance(be)]):[3,2];case 1:return[2,(n.pages=o.sent(),n)];case 2:return o.trys.push([2,4,,5]),t=!G,[4,Me.promptLogin(e,t,!0)];case 3:return[2,{success:!0,pages:o.sent().pages}];case 4:return[2,{success:!1,reason:o.sent()}];case 5:return[2]}}))}))},applySessionToken:function(e,t,n){return void 0===n&&(n=!1),(0,i.mG)(this,void 0,Promise,(function(){var o,s,u,c;return(0,i.Jh)(this,(function(l){switch(l.label){case 0:return r.interactionStarted(C.SE.VERIFY_TOKEN),[4,Ie(oe,{method:"POST",body:"token="+e})];case 1:if(o=l.sent(),s=o.payload,u=o.errorCode)throw u;return r.interactionEnded(C.SE.VERIFY_TOKEN),[4,a.loadNewSession({reason:"memberLogin"})];case 2:return l.sent(),[4,Me.getSmToken()];case 3:return be=l.sent(),we=e,null==t?[3,4]:(c=t,[3,6]);case 4:return[4,Me.getMemberDetails()];case 5:c=l.sent(),l.label=6;case 6:return Se=c,[4,Promise.all(Object.values(Ee).map((function(e){return(0,i.mG)(void 0,void 0,void 0,(function(){var t;return(0,i.Jh)(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,e()];case 1:return n.sent(),[3,3];case 2:return t=n.sent(),r.captureError(t,{tags:{feature:"site-members"}}),[3,3];case 3:return[2]}}))}))})))];case 7:return l.sent(),n?[2,s.pages]:[2]}}))}))},getSmToken:function(){return(0,i.mG)(this,void 0,Promise,(function(){var e;return(0,i.Jh)(this,(function(t){switch(t.label){case 0:return[4,o.envFetch(ue).then((function(e){return e.json()}))];case 1:return e=t.sent().clientSpecMap,[2,Object.values(e).find((function(e){return"sitemembers"===e.type})).smtoken]}}))}))},authorizeMemberPagesByCookie:function(){return(0,i.mG)(this,void 0,Promise,(function(){var e,t,n,o;return(0,i.Jh)(this,(function(i){switch(i.label){case 0:return e=(0,g.yF)(d)?{headers:{cookie:"smSession="+U}}:void 0,[4,Ie(ie,e)];case 1:if(t=i.sent(),n=t.authorizedPages,o=t.errorCode)throw o;return[2,n]}}))}))},authorizeMemberPagesByToken:function(e){return(0,i.mG)(this,void 0,Promise,(function(){var t,n,o;return(0,i.Jh)(this,(function(i){switch(i.label){case 0:return e===U?[2,this.authorizeMemberPagesByCookie()]:[4,Ie(oe,{method:"POST",body:"token="+e})];case 1:if(t=i.sent(),n=t.payload,o=t.errorCode)throw o;return[2,n.pages]}}))}))},authorizeMemberPagesBySignedInstance:function(e){return(0,i.mG)(this,void 0,Promise,(function(){var t,n,o;return(0,i.Jh)(this,(function(i){switch(i.label){case 0:return[4,Ie(ie,{headers:{authorization:e}})];case 1:if(t=i.sent(),n=t.authorizedPages,o=t.errorCode)throw o;return[2,n]}}))}))},getMemberDetails:function(e){return void 0===e&&(e=!1),(0,i.mG)(this,void 0,Promise,(function(){var t,n,o;return(0,i.Jh)(this,(function(s){switch(s.label){case 0:return!Se.id||e?[3,1]:[2,Se];case 1:return be?[4,Ie("/_api/wix-sm-webapp/member/"+be+"?collectionId="+M+"&metaSiteId="+H)]:[3,5];case 2:if(t=s.sent(),n=t.payload,o=t.errorCode)throw o;return Se=(0,E.Ky)(n),e?[4,Promise.all(Object.values(Le).map((function(e){return(0,i.mG)(void 0,void 0,void 0,(function(){var t;return(0,i.Jh)(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,e()];case 1:return n.sent(),[3,3];case 2:return t=n.sent(),r.captureError(t,{tags:{feature:"site-members"}}),[3,3];case 3:return[2]}}))}))})))]:[3,4];case 3:s.sent(),s.label=4;case 4:return[2,Se];case 5:return[2,null]}}))}))},register:function(e,t,n,o,s,a,u){return(0,i.mG)(this,void 0,Promise,(function(){var c,l,d,m,h,g,f,v,b,S,w;return(0,i.Jh)(this,(function(D){switch(D.label){case 0:a=null!=a&&a,D.label=1;case 1:return D.trys.push([1,10,,11]),r.interactionStarted(C.SE.CODE_SIGNUP),P.trackEvent({eventName:"CustomEvent",params:{eventCategory:"Site members",eventAction:"Sign up Submit",eventLabel:"Wix"}}),c={email:e,password:t,profilePrivacyStatus:o,contactInfo:(0,E.t1)(n||{}),defaultFlow:s,recaptchaToken:u},[4,Ie("/_api/wix-sm-webapp/v1/auth/signup",{method:"POST",headers:{"Content-Type":"application/json",authorization:j||""},body:JSON.stringify(c)})];case 2:return l=D.sent(),d=l.member,m=l.approvalToken,h=l.session,g=d.emailVerified,f=null==h?void 0:h.token,v="ACTIVE"===(null==d?void 0:d.status)?"ACTIVE":"PENDING",f||g||"ACTIVE"!==d.status?[3,4]:[4,Me.showConfirmationEmailDialog(d.id)];case 3:return D.sent(),r.interactionEnded(C.SE.CODE_SIGNUP),[2,{member:d,status:v}];case 4:return s&&"APPLICANT"===(null==d?void 0:d.status)||!f?[4,p()]:[3,7];case 5:return b=D.sent(),[4,Me.showNotificationDialog("",(b("siteMembersTranslations","SMApply_Success1","Success! Your member login request has been sent and is awaiting approval.")+" "+b("siteMembersTranslations","SMApply_Success2","The site administrator will notify you via email ({0}) once your request has been approved.")).replace("{0}",e),b("siteMembersTranslations","SMContainer_OK","OK"))];case 6:return D.sent(),r.interactionEnded(C.SE.CODE_SIGNUP),[2,{member:d,status:v,approvalToken:m}];case 7:return[4,Me.applySessionToken(f,d,a)];case 8:return S=D.sent(),r.interactionEnded(C.SE.CODE_SIGNUP),P.trackEvent({eventName:"CustomEvent",params:{eventCategory:"Site members",eventAction:"Sign up Success",eventLabel:"Wix"}}),[2,(0,i.pi)({member:d,status:v,sessionToken:f},a&&S?{pages:S}:{})];case 9:return[3,11];case 10:throw w=D.sent(),P.trackEvent({eventName:"CustomEvent",params:{eventCategory:"Site members",eventAction:"Sign up Failure",eventLabel:"Wix"}}),(0,E.fJ)(w)&&r.interactionEnded(C.SE.CODE_SIGNUP),w;case 11:return[2]}}))}))},sendForgotPasswordMail:function(e){return(0,i.mG)(this,void 0,void 0,(function(){var t,n,o,s;return(0,i.Jh)(this,(function(i){switch(i.label){case 0:return r.interactionStarted(C.SE.RESET_PASSWORD),t=l.userLanguage,n=encodeURIComponent(Q),o=encodeURIComponent(e),[4,Ie("/_api/wix-sm-webapp/member/sendForgotPasswordMail",{method:"POST",body:"returnUrl="+n+"&collectionId="+M+"&metaSiteId="+H+"&lang="+t+"&email="+o})];case 1:if(s=i.sent().errorCode)throw s;return r.interactionEnded(C.SE.RESET_PASSWORD),[2]}}))}))},sendSetPasswordEmail:function(e,t){return void 0===t&&(t=!1),(0,i.mG)(this,void 0,Promise,(function(){var n,o,r;return(0,i.Jh)(this,(function(i){switch(i.label){case 0:return[4,Ie("/_api/wix-sm-webapp/members/v1/auth/members/send-set-password-email",{method:"POST",headers:{"Content-Type":"application/json",authorization:j||""},body:JSON.stringify({email:e,hideIgnoreMessage:t})})];case 1:if(n=i.sent(),o=n.payload,r=n.errorCode)throw r;return[2,o.accepted]}}))}))},changePassword:function(e,t){return(0,i.mG)(this,void 0,void 0,(function(){var n,o;return(0,i.Jh)(this,(function(i){switch(i.label){case 0:return n=encodeURIComponent(e),[4,Ie(se,{method:"POST",body:"newPassword="+n+"&forgotPasswordToken="+t})];case 1:if(o=i.sent().errorCode)throw o;return[2]}}))}))},resendEmailVerification:function(e){return(0,i.mG)(this,void 0,void 0,(function(){var t;return(0,i.Jh)(this,(function(n){switch(n.label){case 0:return[4,Ie("/_api/wix-sm-webapp/tokens/email/resend/"+e)];case 1:if(t=n.sent().errorCode)throw t;return[2]}}))}))},logout:function(e){return(0,i.mG)(this,void 0,void 0,(function(){var t;return(0,i.Jh)(this,(function(n){switch(n.label){case 0:return be?[4,Ie(re,{method:"POST"})]:[2];case 1:return n.sent(),[4,Promise.all(Object.values(ye).map((function(e){return(0,i.mG)(void 0,void 0,void 0,(function(){var t;return(0,i.Jh)(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,e()];case 1:return n.sent(),[3,3];case 2:return t=n.sent(),r.captureError(t,{tags:{feature:"site-members"}}),[3,3];case 3:return[2]}}))}))})))];case 2:return n.sent(),e?(t="./"+e.replace(/^\//,""),[4,m.navigate(t)]):[3,4];case 3:n.sent(),n.label=4;case 4:return(0,g.yF)(d)||d.document.location.reload(),[2]}}))}))},registerToUserLogin:function(e){var t=(0,w.uniqueId)("callback");return Ee[t]=e,t},unRegisterToUserLogin:function(e){delete Ee[e]},registerToMemberLogout:function(e){var t=(0,w.uniqueId)("logout_callback");return ye[t]=e,t},unRegisterToMemberLogout:function(e){delete ye[e]},registerToMemberDetailsRefresh:function(e){var t=(0,w.uniqueId)("mdrcb");return Le[t]=e,t},unRegisterToMemberDetailsRefresh:function(e){delete Le[e]},showWelcomeDialog:function(e){return void 0===e&&(e=!0),(0,i.mG)(this,void 0,void 0,(function(){var t,n,o;return(0,i.Jh)(this,(function(i){return t={isCloseable:e},n=f.getParsedUrl(),o={onCloseDialogCallback:function(){Te.closingDialog("WelcomeDialog");var e=new URL(s.requestUrl).hostname,t=0===e.indexOf("www")?e.substr(3):e;I("sm_ef","/",t),x="",Ae.hideDialog(),m.navigate(n.href)},onSubmitCallback:function(){var e=new URL(s.requestUrl).hostname,t=0===e.indexOf("www")?e.substr(3):e;I("sm_ef","/",t),x="",Ae.hideDialog(),K&&m.navigate("./account/my-account"),m.navigate(n.href)}},Ae.displayDialog("WelcomeDialog",t,o),[2]}))}))},showNoPermissionsToPageDialog:function(e){return(0,i.mG)(this,void 0,void 0,(function(){var t;return(0,i.Jh)(this,(function(n){return t={onCloseDialogCallback:function(){Ae.hideDialog(),e&&e()},onSwitchAccountLinkClick:function(){Me.logout()}},Ae.displayDialog("NoPermissionsToPageDialog",{},t),[2]}))}))},showResetPasswordDialog:function(e){return(0,i.mG)(this,void 0,void 0,(function(){var t,n;return(0,i.Jh)(this,(function(o){return t={isCloseable:!0},n={onCloseDialogCallback:function(){Te.closingDialog("ResetPasswordDialog");var e=f.getParsedUrl();e.searchParams.delete("forgotPasswordToken"),e.searchParams.delete("forgotPasswordLang"),f.pushUrlState(e),Ae.hideDialog(),m.navigate(e.href)},onSubmitCallback:function(n){return(0,i.mG)(this,void 0,void 0,(function(){var o,r,s=this;return(0,i.Jh)(this,(function(a){switch(a.label){case 0:return[4,p()];case 1:o=a.sent(),a.label=2;case 2:return a.trys.push([2,4,,5]),[4,Me.changePassword(n,e)];case 3:return a.sent(),Me.showNotificationDialog(o("siteMembersTranslations","siteMembersTranslations_Reset_Password_Sucess_Title","Your password has been changed."),"",o("siteMembersTranslations","SMContainer_OK","OK"),(function(){return(0,i.mG)(s,void 0,void 0,(function(){var e;return(0,i.Jh)(this,(function(t){switch(t.label){case 0:return(e=f.getParsedUrl()).searchParams.delete("forgotPasswordToken"),e.searchParams.delete("forgotPasswordLang"),f.pushUrlState(e),[4,Me.showLoginDialog()];case 1:return t.sent(),m.navigate(e.href),[2]}}))}))})),[3,5];case 4:if(-19972!==(r=a.sent()))throw r;return Me.showNotificationDialog(o("siteMembersTranslations","siteMembersTranslations_PASSWORD_HAS_EXPIRED_TITLE","Your link to create a new password has expired"),o("siteMembersTranslations","siteMembersTranslations_PASSWORD_HAS_EXPIRED_TEXT","To continue, resend a new link to your email."),o("siteMembersTranslations","siteMembersTranslations_PASSWORD_HAS_EXPIRED_OK","Resend Link"),(function(){return Me.promptForgotPassword(t.isCloseable).then((function(){var e=f.getParsedUrl();m.navigate(e.href)}))})),[3,5];case 5:return[2]}}))}))}},Ae.displayDialog("ResetPasswordDialog",t,n),[2]}))}))},showLoginDialog:function(e,t,n){return void 0===e&&(e=!0),void 0===t&&(t="fullscreen"),void 0===n&&(n=!1),(0,i.mG)(this,void 0,Promise,(function(){var o=this;return(0,i.Jh)(this,(function(s){return fe&&(null==S?void 0:S.isPopupPage(fe))?[2,Me.showCustomAuthenticationDialog(fe,n)]:[2,new Promise((function(s,a){return(0,i.mG)(o,void 0,void 0,(function(){var o,u;return(0,i.Jh)(this,(function(i){switch(i.label){case 0:return _e.assignRequestAuthenticationRejection(a),o={displayMode:t,language:l.userLanguage,isCloseable:e,smCollectionId:M,svSession:O,biVisitorId:q,metaSiteId:H,isSocialLoginGoogleEnabled:de,isSocialLoginFacebookEnabled:!F&&le,isEmailLoginEnabled:!F,isSocialAuthSupported:te,useGoogleSdk:Re},u={onCloseDialogCallback:function(){Ae.hideDialog(),Te.closingDialog("MemberLoginDialog",t),_e.rejectAuthenticationRequest()},submit:function(e,o,i){return r.interactionStarted(C.SE.DEFAULT_LOGIN),Te.emailAuthSubmitClicked("MemberLoginDialog",t),Me.login(e,o,i,n).then((function(e){r.interactionEnded(C.SE.DEFAULT_LOGIN),Ae.hideDialog(),s(e)})).catch((function(e){throw(0,E.Y2)(e)&&r.interactionEnded(C.SE.DEFAULT_LOGIN),e}))},onForgetYourPasswordClick:function(){Me.promptForgotPassword(e)},onSwitchDialogLinkClick:function(){Me.showSignUpDialog(e,t).then(s,(function(){_e.rejectAuthenticationRequest()}))},onTokenMessage:function(e,t,o){void 0===o&&(o=!1);var i=o?"PUBLIC":"PRIVATE";return Me.handleOauthToken(e,t,"memberLoginDialog",i,n).then((function(e){Ae.hideDialog(),s(e)}))},onBackendSocialLogin:function(e,t){return Me.handleSocialLoginResponse(e,t,n).then((function(e){Ae.hideDialog(),s(e)}))},getHostReadyPayload:function(){return{visitorId:q,svSession:O}}},Te.loginOrSignUpDialogLoaded("MemberLoginDialog",t),[4,Ae.displayDialog("MemberLoginDialog",o,u,ke())];case 1:return i.sent(),Me.closeCustomAuthenticationDialogs(!0),[2]}}))}))}))]}))}))},showSignUpDialog:function(e,t,n){return void 0===e&&(e=!0),void 0===t&&(t="fullscreen"),void 0===n&&(n=!1),(0,i.mG)(this,void 0,Promise,(function(){var o=this;return(0,i.Jh)(this,(function(s){return pe&&(null==S?void 0:S.isPopupPage(pe))?[2,Me.showCustomAuthenticationDialog(pe,n)]:[2,new Promise((function(s,a){return(0,i.mG)(o,void 0,void 0,(function(){var o,u;return(0,i.Jh)(this,(function(c){switch(c.label){case 0:return _e.assignRequestAuthenticationRejection(a),o={displayMode:t,language:l.userLanguage,isCloseable:e,smCollectionId:M,biVisitorId:q,svSession:O,metaSiteId:H,isSocialLoginGoogleEnabled:de,isSocialLoginFacebookEnabled:!F&&le,isSocialAuthSupported:te,isEmailLoginEnabled:!F,isCommunityInstalled:N,joinCommunityCheckedByDefault:ve,isTermsOfUseNeeded:!(!(null==me?void 0:me.enabled)||!V.termsOfUse),isPrivacyPolicyNeeded:!(!(null==he?void 0:he.enabled)||!V.privacyPolicy),isCodeOfConductNeeded:!(!(null==ge?void 0:ge.enabled)||!V.codeOfConduct),termsOfUseLink:V.termsOfUse,privacyPolicyLink:V.privacyPolicy,codeOfConductLink:V.codeOfConduct,useGoogleSdk:Re},u={onCloseDialogCallback:function(){Ae.hideDialog(),Te.closingDialog("SignUpDialog",t),_e.rejectAuthenticationRequest()},submit:function(e,o,a){var u="boolean"==typeof a?a:a.isCommunityChecked,c="boolean"==typeof a||null==a?void 0:a.recaptchaToken;r.interactionStarted(C.SE.DEFAULT_SIGNUP),Te.emailAuthSubmitClicked("SignUpDialog",t);var l=u?C.iY.PUBLIC:C.iY.PRIVATE;return Me.register(e,o,void 0,l,void 0,n,c).then((function(e){r.interactionEnded(C.SE.DEFAULT_SIGNUP);var t=e.member,o=e.sessionToken,a=e.pages;o&&(Ae.hideDialog(),s((0,i.pi)({member:t,sessionToken:o},n?{pages:a}:{})))})).catch((function(e){throw(0,E.fJ)(e)&&r.interactionEnded(C.SE.DEFAULT_SIGNUP),e}))},onSwitchDialogLinkClick:function(){Me.showLoginDialog(e,t,n).then(s,(function(){_e.rejectAuthenticationRequest()}))},onTokenMessage:function(e,t,o){void 0===o&&(o=!1);var i=o?"PUBLIC":"PRIVATE";return Me.handleOauthToken(e,t,"memberLoginDialog",i,n).then((function(e){Ae.hideDialog(),s(e)}))},onBackendSocialLogin:function(e,t){return Me.handleSocialLoginResponse(e,t,n).then((function(e){Ae.hideDialog(),s(e)}))},getHostReadyPayload:function(){return{visitorId:q,svSession:O}}},Te.loginOrSignUpDialogLoaded("SignUpDialog",t),[4,Ae.displayDialog("SignUpDialog",o,u,ke())];case 1:return c.sent(),Me.closeCustomAuthenticationDialogs(!0),[2]}}))}))}))]}))}))},showNotificationDialog:function(e,t,n,o,r){return void 0===o&&(o=function(){return 0}),void 0===r&&(r=function(){return 0}),(0,i.mG)(this,void 0,void 0,(function(){var s,a;return(0,i.Jh)(this,(function(i){switch(i.label){case 0:return s={isCloseable:!0,title:e,description:t,okButtonText:n},a={onCloseDialogCallback:function(){Te.closingDialog("NotificationDialog"),Ae.hideDialog(),r()},onOkButtonClick:function(){Ae.hideDialog(),o()}},[4,Ae.displayDialog("NotificationDialog",s,a)];case 1:return i.sent(),[2]}}))}))},showConfirmationEmailDialog:function(e,t){return void 0===t&&(t=!0),(0,i.mG)(this,void 0,void 0,(function(){var n,o;return(0,i.Jh)(this,(function(r){switch(r.label){case 0:return n={isCloseable:!0,isSignUp:t},o={onCloseDialogCallback:function(){Te.closingDialog("ConfirmationEmailDialog"),Ae.hideDialog()},onResendConfirmationEmail:function(){return(0,i.mG)(this,void 0,void 0,(function(){return(0,i.Jh)(this,(function(t){switch(t.label){case 0:return[4,Me.resendEmailVerification(e)];case 1:return t.sent(),[4,Me.showConfirmationEmailDialog(e,!1)];case 2:return t.sent(),[2]}}))}))}},[4,Ae.displayDialog("ConfirmationEmailDialog",n,o)];case 1:return r.sent(),[2]}}))}))},showCustomAuthenticationDialog:function(e,t){return void 0===t&&(t=!1),(0,i.mG)(this,void 0,Promise,(function(){var n=this;return(0,i.Jh)(this,(function(o){if(!S)throw new Error("popup unavailable");return[2,new Promise((function(o,r){return(0,i.mG)(n,void 0,void 0,(function(){var n,s=this;return(0,i.Jh)(this,(function(a){switch(a.label){case 0:return n=Me.registerToUserLogin((function(){return(0,i.mG)(s,void 0,void 0,(function(){var r,s,a,u;return(0,i.Jh)(this,(function(c){switch(c.label){case 0:return r=o,s=[{member:Se,sessionToken:we}],t?(u={},[4,Me.authorizeMemberPagesBySignedInstance(be)]):[3,2];case 1:return u.pages=c.sent(),a=u,[3,3];case 2:a={},c.label=3;case 3:return r.apply(void 0,[i.pi.apply(void 0,s.concat([a]))]),Me.unRegisterToUserLogin(n),S.getCurrentPopupId()===e&&S.closePopupPage(),[2]}}))}))})),[4,_e.openPopupPage(e,r,(function(){Me.unRegisterToUserLogin(n)}))];case 1:return a.sent(),Ae.hideDialog(),[2]}}))}))}))]}))}))},closeCustomAuthenticationDialogs:function(e){return void 0===e&&(e=!1),(0,i.mG)(this,void 0,void 0,(function(){var t;return(0,i.Jh)(this,(function(n){switch(n.label){case 0:return(t=null==S?void 0:S.getCurrentPopupId())&&[pe,fe].includes(t)?(e&&_e.preventCustomPopupCloseCallback(),[4,S.closePopupPage()]):[3,2];case 1:n.sent(),_e.allowCustomPopupCloseCallback(),n.label=2;case 2:return[2]}}))}))},getForgotPasswordToken:function(){return new URL((0,g.yF)(d)?s.requestUrl:location.href).searchParams.get("forgotPasswordToken")},shouldDisplayWelcomeDialog:function(){return x&&K},appWillMount:function(){switch(new URL(s.requestUrl).searchParams.get("showDialog")){case"MemberLoginDialog":Me.showLoginDialog();break;case"SignUpDialog":Me.showSignUpDialog();break;case"RequestPasswordResetDialog":Me.promptForgotPassword();break;case"ResetPasswordDialog":Me.showResetPasswordDialog("faketoken");break;case"WelcomeDialog":Me.showWelcomeDialog();break;case"NoPermissionsToPageDialog":Me.showNoPermissionsToPageDialog();break;case"NotificationDialog":Me.showNotificationDialog("title","description","ok");break;case"ConfirmationEmailDialog":Me.showConfirmationEmailDialog("fakemember")}},pageWillUnmount:function(e){var t=e.pageId;[pe,fe].includes(t)||Ae.hideDialog()},getSocialAuthComponentProps:function(){return(0,E.IO)({config:e,viewerModel:s,sessionManager:a,handleOauthToken:Me.handleOauthToken,handleSocialLoginResponse:Me.handleSocialLoginResponse,isSocialAuthSupported:ne})}};return n.update((function(){return{shouldShowRenderingBlockingDialogs:function(){return!(!Me.getForgotPasswordToken()&&!Me.shouldDisplayWelcomeDialog())},showRenderingBlockingDialogs:function(){var e=Me.getForgotPasswordToken();return e?Me.showResetPasswordDialog(e):Me.shouldDisplayWelcomeDialog()?Me.showWelcomeDialog():void 0}}})),Me})),R=n(59032),_=n(95793),M=n(81600),O=(0,o.ff)([D.n9],(function(e){return{getTpaHandlers:function(){var t=this,n=function(n,o,r){return(0,i.mG)(t,void 0,Promise,(function(){var t,n,o,s;return(0,i.Jh)(this,(function(i){switch(i.label){case 0:return[4,e.getMemberDetails()];case 1:return(t=i.sent())?(null===(n=r.appClientSpecMapData)||void 0===n?void 0:n.isWixTPA)?[2,{attributes:{firstName:null!==(o=t.firstName)&&void 0!==o?o:"",lastName:null!==(s=t.lastName)&&void 0!==s?s:"",privacyStatus:t.profilePrivacyStatus},name:t.memberName,email:t.loginEmail,id:t.id,owner:t.owner,status:t.status}]:[2,{id:t.id,owner:t.owner,status:t.status}]:[2,null]}}))}))},o=function(n,o){return void 0===o&&(o={}),(0,i.mG)(t,void 0,Promise,(function(){var t,n,r;return(0,i.Jh)(this,(function(i){switch(i.label){case 0:return[4,e.promptLogin({mode:o.mode,modal:o.modal})];case 1:return t=i.sent().member,[2,{attributes:{firstName:null!==(n=t.firstName)&&void 0!==n?n:"",lastName:null!==(r=t.lastName)&&void 0!==r?r:"",privacyStatus:t.profilePrivacyStatus},name:t.memberName,email:t.loginEmail,id:t.id,owner:t.owner,status:t.status}]}}))}))};return{currentMember:n,smCurrentMember:n,logOutCurrentMember:(0,M.u)(["site"],(function(t,n){e.logout(null==n?void 0:n.url)})),requestLogin:(0,M.u)(["site"],o),smRequestLogin:(0,M.u)(["site"],o)}}}})),U=(0,o.ff)([D.n9,(0,o.t6)(r.$e,D.u2),u.xP],(function(e,t,n){var o=t.componentIds;return{pageWillMount:function(){return(0,i.mG)(this,void 0,void 0,(function(){var t;return(0,i.Jh)(this,(function(r){return t=o.reduce((function(t,n){var o,r=e.getSocialAuthComponentProps();return(0,i.pi)((0,i.pi)({},t),((o={})[n]=r,o))}),{}),n.update(t),[2]}))}))}}})),G=(0,o.ff)([(0,o.t6)(r.Wf,D.u2)],(function(e){return{handle:function(t){return(0,i.mG)(void 0,void 0,void 0,(function(){var n,o,r;return(0,i.Jh)(this,(function(i){return n=e.get(),o=n.shouldShowRenderingBlockingDialogs,r=n.showRenderingBlockingDialogs,o()?(r(),[2,null]):[2,t]}))}))}}})),N=function(e){e(D.n9,R.j.AppWillMountHandler,R.j.AppDidMountHandler).to(A),e(f.BD.BlockingDialogs).to(G)},J=function(e){e(_.g).to(O),e(R.j.PageWillMountHandler).to(U),e(R.j.PageWillUnmountHandler).to((0,o.ff)([D.n9],(function(e){return{pageWillUnmount:function(t){return e.pageWillUnmount(t)}}})))}}}]);
//# sourceMappingURL=https://static.parastorage.com/services/wix-thunderbolt/dist/siteMembers.ad2643ee.chunk.min.js.map